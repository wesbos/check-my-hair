(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const s of n.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&i(s)}).observe(document,{childList:!0,subtree:!0});function o(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(r){if(r.ep)return;r.ep=!0;const n=o(r);fetch(r.href,n)}})();function m(t){return{get(e,o,i){const r=e[o];return r instanceof Function?function(...n){const s=r.apply(this===i?e:this,n);return(o==="add"||o==="delete"||o==="clear")&&(console.log("Mutation, re-render"),t()),s}:r}}}const c=document.querySelector(".video");document.querySelector(".text");const l=document.querySelector(".start-camera"),f=localStorage.getItem("ignoredCameras"),d=document.querySelector(".ignoredCameras ul"),a=new Proxy(new Set,m(()=>{g(),u()}));function g(){if(!d)return;const t=Array.from(a).map(e=>`<li>${e} <button data-remove-ignore="${e}">×</button></li>`).join("");d.innerHTML=t}if(f){const t=JSON.parse(f);Array.isArray(t)&&(console.log("Restoring ignored cameras",t),t.forEach(e=>a.add(e)))}function v(t){const{id:e}=t.target.dataset;e&&(a.add(e),localStorage.setItem("ignoredCameras",JSON.stringify([...a])),console.log("ignored",a))}async function p(){const t=await navigator.mediaDevices.enumerateDevices(),e=new Set;return t.filter(i=>i.kind==="videoinput").filter(i=>!a.has(i.deviceId)).filter(i=>!a.has(i.label)).filter(i=>e.has(i.deviceId)?!1:(e.add(i.deviceId),!0))}function y(t){var i;const e=`
    <div class="camera">
      <video autoplay playsinline muted controls></video>
      <div class="controls">
        <p>${t.label}</p>
        <button class="ignore" data-id="${t.label||t.deviceId}">× Ignore</button>
      </div>
    </div>
  `,o=document.createRange().createContextualFragment(e);return(i=o.querySelector("button.ignore"))==null||i.addEventListener("click",v),o}async function u(){if(!c)return;c.innerHTML="",await navigator.mediaDevices.getUserMedia({audio:!1,video:!0}),console.log("initial stream");const t=await p(),e=t.map(n=>navigator.mediaDevices.getUserMedia({audio:!1,video:{deviceId:{exact:n.deviceId}}})),o=await Promise.all(e).catch(console.error);t.map(y).forEach(n=>c.append(n)),c.querySelectorAll("video").forEach((n,s)=>{n.srcObject=o[s]})}l==null||l.addEventListener("click",u);c==null||c.addEventListener("click",t=>{if(t.target instanceof HTMLVideoElement){const e=t.target;"requestPictureInPicture"in t.target&&e.requestPictureInPicture(),"webkitSupportsPresentationMode"in e&&e.webkitSetPresentationMode(e.webkitPresentationMode==="picture-in-picture"?"inline":"picture-in-picture")}});d==null||d.addEventListener("click",t=>{if(!(t.target instanceof HTMLButtonElement))return;const{removeIgnore:e}=t.target.dataset;e&&a.delete(e)});u();
